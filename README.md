# Novel Forum [크롤링 및 추천시스템]

개요
---
- 오늘날에는 웹소설 연재 플랫폼이 굉장히 많아 어디에 어떤 작품이 올라왔는지 확인하기 어려운 상황입니다.

- 때문에, 어떤 플랫폼에 어떤 소설이 올라와 있는지 확인할 수 있는 사이트를 만들고자 합니다.

- 다만, 단순히 어디에 어떤 소설이 있는지 확인하는 것에서 그치지 않고, 나에게 맞는 소설을 추천해주는 기능을 비롯하여 다양한 기능을 가진 사이트를 만들어보고자 합니다.


목표
---
- 각 플랫폼에 대한 크롤링을 통해 소설 정보를 가져옵니다.
- 소설 정보 및 리뷰를 가지고 추천 시스템을 개발합니다.


기술 스택
---
<img src="https://img.shields.io/badge/FastAPI-009688?style=for-the-badge&logo=FastAPI&logoColor=white">


구현 사항
---
### 추천 시스템 1
-	각 소설 별로 유사한 소설 추천 (컨텐츠 기반 필터링)
목표
-	특정 소설을 재밌게 봤다면, 그와 유사한 소설을 좋아할 확률이 높다고 생각해 소설 단위로 유사한 소설 목록을 제공하고자 합니다.

고민한 점
-	무엇을 기준으로 유사도를 측정할 것인가?

결론
-	줄거리와 제목을 기준으로 유사도를 측정하기로 했습니다.
-	소설 플랫폼 크롤링 결과로 얻을 수 있는 것에는 소설의 제목, 장르, 작가 이름, 줄거리, 태그, 가격, 완결 여부 등의 조건이 있었습니다.
-	초기에는 태그와 장르를 기반으로 유사도를 측정하려고 했으나, 특정 플랫폼(네이버 시리즈)에서 태그 정보를 추출할 수 없어 다른 방법을 고려했습니다.
-	크롤링한 정보를 바탕으로 모든 소설에 공통적으로 가지고 있으면서 다른 소설들과의 차이점을 어느 정도 보이는 요소를 고민한 결과 줄거리와 제목을 요소로 삼기로 했습니다.
-	줄거리와 제목은 모든 소설이 길든 짧든 가지고 있으며, 소설의 큰 흐름과 같은 주요 특징을 대표하는 요소라고 생각하기 때문입니다.
-	요즘 웹소설에서 제목은 대체로 문장의 형태를 가집니다.
-	그래서 줄거리와 제목을 합쳐서 하나의 문장으로 만든 다음 해당 문장 간의 유사도를 측정하기로 했습니다.
 
구현 방안
-	사전 학습된 Sentence-BERT 모델(Sentence Transformer)을 사용했습니다.
-	사용한 모델은 https://github.com/jhgan00/ko-sentence-transformers  를 이용했습니다. (Hugging Face에서 가장 다운로드 수가 많은 모델을 사용했습니다. 해당 모델은 내부적으로 평균 폴링 방식으로 문장 임베딩을 생성합니다.)
-	전처리의 경우에는 처음에는 어간 추출이나 형태소 분석 등을 수행했는데, 유사도의 값 자체는 높게 나오지만, 실제 결과로 나온 소설들을 비교해보면 오차가 좀 더 심해지는 경향을 보였습니다.
-	형태소 분석이나 어간 추출로 인해 단어들이 원형이나 기본 형태로 변환되는데, 이 때문에 다의어 처리나 단어 손실 등의 문제가 발생해 오차가 커지는 것으로 보였습니다.
-	그래서 전처리 작업에서는 간단하게 한자, 해시 태그, 작가 설명 정도를 제거했습니다.
-	전처리 후, 모든 소설에 대해서 사전학습된 모델을 사용해서 줄거리와 제목을 합친 문장에 대한 임베딩을 진행합니다.
-	문장 임베딩 수행 결과인 문장 벡터를 가지고 각 소설들에 대해서 코사인 유사도를 측정했고, 그 결과를 내림차순으로 정렬해서 상위 10개 항목을 가져와 제공해서 소설 상세 정보 페이지에 같이 제공하고 있습니다.

한계점 및 미구현 사항
-	성능 평가에 대한 기준을 잡지 못했습니다.
-	줄거리와 제목 간의 가중치 설정이 제대로 이뤄지지 않았습니다.
-	추가적인 파인 튜닝을 하지 못 했습니다. (평균 폴링 방식 이외의 문장 임베딩 방식을 테스트 해보지 않았습니다.)

 
### 추천 시스템 2
-	리뷰를 이용한 사용자 취향에 맞는 웹 소설 추천 - CF(협업 필터링)기반 - 잠재 요인 기반
목표
-	리뷰를 작성한 사용자를 기반으로 취향이 비슷한 유저들이 읽었던 소설을 사용자에게 추천한다.
고려사항 1
-	데이터를 어디서 구할 것인지?
: 모델을 학습하기 위해 일단 저희와 유사한 데이터를 수집하는 것이 가장 큰 문제였습니다. 저희의 리뷰는 웹 소설을 읽고 나서의 감상평이 필요했으므로, 웹 포털에서 리뷰에서 데이터를 수집 했어야 하는 상황이었으므로, 웹 소설 전체에 대한 리뷰를 평가하는 리디 북스의 리뷰가 가장 저희의 사이트의 리뷰와 목적이 적합하다고 생각하여서, 리디 북스의 리뷰를 크롤링 하였습니다. 거기서 대략 35000개의 데이터를 얻을 수 있었고, 데이터를 정제하여28000개의 데이터를 얻을 수 있었습니다. 
- 841명의 회원과 6283개의 소설에 대한 데이터 
 ![image](https://github.com/jinsoo335/SSUNOVEL_python/assets/88032932/a0c9c6c0-6f2f-4e52-8bf0-6762eca45307)



고려사항 2
-	모델 선택
- surprise library를 이용한 모델 선택 
surprise는 다양한 추천 시스템 알고리즘을 제공하는데요, 저희가 취합한 데이터와 가장 적합한  모델을 선택하기 위해 모든 모델에 대해서 성능 지표는 RMSE를 선택하였고, 훈련데이터와 테스트 데이터를 9:1로 분할하여 각 모델에 RMSE를 계산한 결과 아래와 같았습니다.

- 모델 선택 
- KNN (유사도 기반 알고리즘)                      -  CoClustering (클러스터링 기반 알고리즘)  
- SVD(행렬 분해 기반 알고리즘)                - SlopeOne(Slope one 기반 알고리즘)
![image](https://github.com/jinsoo335/SSUNOVEL_python/assets/88032932/cdba70e6-0c15-496c-922d-c04a4f9a7b5d)

여기서 저희가 수집했던 모델과 가장 적합한 널리 쓰이는 SVD를 이용하여 추천 시스템을 구축하기로 결정하였습니다. 
SVD모델은 Matrix factorization(행렬 요인화) 이라는 기법을 기반으로 두고 있습니다. 행렬 요인화 기법은 2차원 행렬인 평가 데이터(사용자 X 아이템) R 을 2개의 행렬로 분해하는 기법을 말합니다. 저희의 예에선 사용자 X 소설(NxM)로 볼 수 있습니다. 아래의 보이는 factors는  잠재 요인이라고 하며 사용자가 주어진 아이템을 평가할 때 고려되는 요인으로 해석할 수 있습니다.
![image](https://github.com/jinsoo335/SSUNOVEL_python/assets/88032932/44a18d3a-6daf-4494-9685-ec1eea0c7487)



MF행렬을 P ( N X K), Q(M X K)로 분할한다음 K안에 있는 값들을 학습하여 
- P X Q(transpose) = R^이되며 R^이 R에 대한 예측치입니다. 
- 위의 fators를 평균이0, 표준편차가 1인 정규분포의 무작위 값으로 초기화한 이후 경사하강법으로 fators의 값을 최소 RMSE 값을 갖는 값을 갖도록 갱신함
여러 최적의 파라미터를 찾기 위해 GridSearchCV를 이용하여 K의 개수, iteration 횟수, SGD 수행 시 learning rate, 의 여러 값을 조합하여 최적의 RMSE를 찾아내는 값을 찾았습니다. 
(n_factors : 잠재 요인 수, n_epoches : 학습시 반복 수, lr_all : 학습률, reg_all : 정규화 계수)
![image](https://github.com/jinsoo335/SSUNOVEL_python/assets/88032932/b40f2e7d-d778-4db3-9222-ae0cfc94f499)

 
이 값을 저희 실제 추천 시스템 모델 구축시 해당 인자 값으로 넘겨주었으며, 추천 탭을 누를 때마다 모델을 사용하여 최적의 리뷰를 내릴 것으로 예상하는 10개의 웹 소설을 선택해 추천 탭에 보여주게 됩니다. 현재는 실제 여러 웹 소설에 대한 리뷰 데이터가 없어 임시로 크롤링한 리디북스의 리뷰 데이터를 사용하여 추천 소설을 보여주게 됩니다.

- 추천 시스템 동작시 아래와 같은 예상 평점을 계산해 반환함 
 ![image](https://github.com/jinsoo335/SSUNOVEL_python/assets/88032932/9f80e13f-ecdf-45c4-aea3-cc8b201f66b7)




- 웹사이트에서 보여주게 되는 추천 소설 
![image](https://github.com/jinsoo335/SSUNOVEL_python/assets/88032932/7eaad6d3-1634-42d1-89e6-41db734a66ae)

  
실제로 저희 웹 서비스에 리뷰가 많이 쌓이게 된다면, 추천 시스템은 아래처럼 동작합니다.
1. 리뷰 데이터베이스에서 리뷰를 가져옵니다.
2. 리뷰가 10개 미만인 소설의 리뷰, 리뷰를 10개 미만으로 작성한 사용자의 리뷰는 제외합니다.
3. 정제한 데이터를 가지고 위의 파라미터를 이용해 SVD 모델을 학습시킵니다. 
->SVD 학습 시 파라미터는 크롤링한 리뷰에 대한 최적의 파라미터로, 수정 과정이 필요합니다. 
4. 학습한 모델을 가지고 추천을 받고자 하는 사용자의 읽지 않은 도서 중에 예측 평점이 가장 높은 10개 소설을 추출해 추천 탭에 보여주게 됩니다. 

한계점 및 미구현 사항
-	사용자의 편향된 평점에 대한 고려는 하지 못함. 
-	실제 추천 시스템에서는 여러 모델의 상호 문제를 보안해주기 위해 여러 모델을 사용하지만 저희 모델은 하나만 사용한다는 점.
-	실제로 모델이 추천한 소설이 유저가 좋게 평가할지 객관적인 지표가 부족함.
